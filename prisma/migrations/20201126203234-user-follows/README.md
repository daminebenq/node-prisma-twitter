# Migration `20201126203234-user-follows`

This migration has been generated by Diego Fernandes at 11/26/2020, 5:32:34 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "User" DROP CONSTRAINT "User_userId_fkey"

ALTER TABLE "User" DROP COLUMN "userId"

CREATE TABLE "UserFollows" (
    "id" TEXT NOT NULL,
    "userId" TEXT NOT NULL,
    "targetId" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

ALTER TABLE "UserFollows" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "UserFollows" ADD FOREIGN KEY("targetId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201126202633-tweet-structure..20201126203234-user-follows
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -14,14 +14,13 @@
   id          String          @id @default(uuid())
   email       String          @unique
   name        String?
   password    String
-  followers   User[]          @relation("UserFollowers")
-  Follower    User?           @relation("UserFollowers", fields: [userId], references: [id])
-  userId      String?
   tweets      Tweet[]
   mentionedIn TweetMentions[]
   likedTweets TweetLikes[]
+  following   UserFollows[]   @relation("UserFollowsUser")
+  followers   UserFollows[]   @relation("UserFollowsTarget")
 }
 model Tweet {
   id           String          @id @default(uuid())
@@ -34,8 +33,16 @@
   mentions     TweetMentions[]
   likes        TweetLikes[]
 }
+model UserFollows {
+  id       String @id @default(uuid())
+  user     User   @relation("UserFollowsUser", fields: [userId], references: [id])
+  userId   String
+  target   User   @relation("UserFollowsTarget", fields: [targetId], references: [id])
+  targetId String
+}
+
 model TweetMentions {
   id      String @id @default(uuid())
   tweet   Tweet  @relation(fields: [tweetId], references: [id])
   user    User   @relation(fields: [userId], references: [id])
```


